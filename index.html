<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4CAF50">
    <title>نقطة بيع البقالة</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <!-- شريط التنقل العلوي -->
    <nav class="top-nav">
        <div class="nav-brand">
            <i class="fas fa-store"></i>
            <span id="company-name">بقالتي</span>
        </div>
        <div class="nav-actions">
            <button class="btn-icon" id="sync-btn" title="مزامنة البيانات">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="btn-icon" id="settings-btn" title="الإعدادات">
                <i class="fas fa-cog"></i>
            </button>
            <button class="btn-icon" id="fullscreen-btn" title="ملء الشاشة">
                <i class="fas fa-expand"></i>
            </button>
        </div>
    </nav>

    <!-- التبويبات الرئيسية -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab active" data-tab="pos">
                <i class="fas fa-cash-register"></i>
                <span>نقطة البيع</span>
            </button>
            <button class="tab" data-tab="products">
                <i class="fas fa-boxes"></i>
                <span>المنتجات</span>
            </button>
            <button class="tab" data-tab="categories">
                <i class="fas fa-tags"></i>
                <span>الفئات</span>
            </button>
            <button class="tab" data-tab="customers">
                <i class="fas fa-users"></i>
                <span>العملاء</span>
            </button>
            <button class="tab" data-tab="suppliers">
                <i class="fas fa-truck"></i>
                <span>الموردين</span>
            </button>
            <button class="tab" data-tab="purchases">
                <i class="fas fa-shopping-cart"></i>
                <span>المشتريات</span>
            </button>
            <button class="tab" data-tab="accounting">
                <i class="fas fa-calculator"></i>
                <span>المحاسبة</span>
            </button>
        </div>
    </div>

    <!-- محتوى التبويبات -->
    <main class="main-content">
        <!-- تبويب نقطة البيع -->
        <div id="pos-tab" class="tab-content active">
            <!-- شريط البحث والتصفية -->
            <div class="search-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="product-search" placeholder="ابحث عن منتج...">
                </div>
                <select id="category-filter">
                    <option value="all">جميع الفئات</option>
                </select>
            </div>

            <!-- شبكة بطاقات الفئات -->
            <div class="categories-grid" id="categories-grid">
                <!-- سيتم تعبئتها ديناميكياً -->
            </div>

            <!-- شبكة بطاقات المنتجات -->
            <div class="products-grid" id="products-grid">
                <!-- سيتم تعبئتها ديناميكياً -->
            </div>

            <!-- سلة المشتريات العائمة -->
            <div class="cart-floating-btn" id="cart-btn">
                <i class="fas fa-shopping-cart"></i>
                <span class="cart-count">0</span>
            </div>

            <!-- لوحة السلة -->
            <div class="cart-panel" id="cart-panel">
                <div class="cart-header">
                    <h3>سلة المشتريات</h3>
                    <button class="btn-icon close-cart">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="cart-items" id="cart-items">
                    <!-- سيتم تعبئتها ديناميكياً -->
                </div>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>المجموع الفرعي:</span>
                        <span id="subtotal">0 ر.ي</span>
                    </div>
                    <div class="summary-row">
                        <span>الضريبة:</span>
                        <span id="tax-amount">0 ر.ي</span>
                    </div>
                    <div class="summary-row total">
                        <span>الإجمالي:</span>
                        <span id="total-amount">0 ر.ي</span>
                    </div>
                    <div class="cart-actions">
                        <button class="btn btn-danger" id="clear-cart">
                            <i class="fas fa-trash"></i> إفراغ السلة
                        </button>
                        <button class="btn btn-success" id="checkout-btn">
                            <i class="fas fa-check"></i> إنهاء البيع
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- تبويب المنتجات -->
        <div id="products-tab" class="tab-content">
            <div class="tab-header">
                <h2>إدارة المنتجات</h2>
                <button class="btn btn-primary" id="add-product-btn">
                    <i class="fas fa-plus"></i> إضافة منتج
                </button>
            </div>
            <div class="products-table-container">
                <table class="data-table" id="products-table">
                    <thead>
                        <tr>
                            <th>الصورة</th>
                            <th>الاسم</th>
                            <th>السعر</th>
                            <th>المخزون</th>
                            <th>التصنيف</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- سيتم تعبئتها ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- تبويب الفئات -->
        <div id="categories-tab" class="tab-content">
            <div class="tab-header">
                <h2>إدارة الفئات</h2>
                <button class="btn btn-primary" id="add-category-btn">
                    <i class="fas fa-plus"></i> إضافة فئة
                </button>
            </div>
            <div class="categories-grid-admin">
                <!-- سيتم تعبئتها ديناميكياً -->
            </div>
        </div>

        <!-- تبويب العملاء -->
        <div id="customers-tab" class="tab-content">
            <div class="tab-header">
                <h2>إدارة العملاء</h2>
                <button class="btn btn-primary" id="add-customer-btn">
                    <i class="fas fa-plus"></i> إضافة عميل
                </button>
            </div>
            <div class="customers-table-container">
                <table class="data-table" id="customers-table">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>الهاتف</th>
                            <th>الرصيد</th>
                            <th>آخر عملية</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- سيتم تعبئتها ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- تبويب الموردين -->
        <div id="suppliers-tab" class="tab-content">
            <div class="tab-header">
                <h2>إدارة الموردين</h2>
                <button class="btn btn-primary" id="add-supplier-btn">
                    <i class="fas fa-plus"></i> إضافة مورد
                </button>
            </div>
            <div class="suppliers-table-container">
                <table class="data-table" id="suppliers-table">
                    <thead>
                        <tr>
                            <th>اسم المورد</th>
                            <th>الهاتف</th>
                            <th>البريد</th>
                            <th>الدين</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- سيتم تعبئتها ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- تبويب المشتريات -->
        <div id="purchases-tab" class="tab-content">
            <div class="tab-header">
                <h2>إدارة المشتريات</h2>
                <button class="btn btn-primary" id="add-purchase-btn">
                    <i class="fas fa-plus"></i> فاتورة شراء جديدة
                </button>
            </div>
            <div class="purchases-table-container">
                <table class="data-table" id="purchases-table">
                    <thead>
                        <tr>
                            <th>رقم الفاتورة</th>
                            <th>المورد</th>
                            <th>التاريخ</th>
                            <th>المجموع</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- سيتم تعبئتها ديناميكياً -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- تبويب المحاسبة -->
        <div id="accounting-tab" class="tab-content">
            <div class="accounting-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3>المبيعات اليومية</h3>
                            <p class="stat-value" id="daily-sales">0 ر.ي</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>المبيعات الشهرية</h3>
                            <p class="stat-value" id="monthly-sales">0 ر.ي</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box-open"></i>
                        </div>
                        <div class="stat-info">
                            <h3>قيمة المخزون</h3>
                            <p class="stat-value" id="inventory-value">0 ر.ي</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>ذمم العملاء</h3>
                            <p class="stat-value" id="customers-balance">0 ر.ي</p>
                        </div>
                    </div>
                </div>

                <div class="accounting-tabs">
                    <button class="accounting-tab active" data-accounting-tab="transactions">المعاملات</button>
                    <button class="accounting-tab" data-accounting-tab="reports">التقارير</button>
                    <button class="accounting-tab" data-accounting-tab="journal">اليومية</button>
                </div>

                <div class="accounting-content">
                    <div id="transactions-tab" class="accounting-tab-content active">
                        <!-- جدول المعاملات -->
                    </div>
                    <div id="reports-tab" class="accounting-tab-content">
                        <!-- التقارير -->
                    </div>
                    <div id="journal-tab" class="accounting-tab-content">
                        <!-- اليومية المحاسبية -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- النماذج (Modals) -->
    <div class="modal" id="product-modal">
        <!-- نموذج إضافة/تعديل منتج -->
    </div>

    <div class="modal" id="category-modal">
        <!-- نموذج إضافة/تعديل فئة -->
    </div>

    <div class="modal" id="customer-modal">
        <!-- نموذج إضافة/تعديل عميل -->
    </div>

    <div class="modal" id="checkout-modal">
        <!-- نموذج إنهاء البيع -->
    </div>

    <!-- الـ Toast للإشعارات -->
    <div class="toast-container" id="toast-container"></div>

    <script src="config.js"></script>
    <script src="database.js"></script>
    <script src="app.js"></script>
<script>
    // تهيئة التطبيق بعد تحميل جميع الملفات
    async function initializeApplication() {
        try {
            console.log('بدء تحميل التطبيق...');
            
            // الانتظار قليلاً لضمان تحميل جميع الملفات
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // التحقق من وجود الكلاس الأساسي
            if (typeof GroceryPOSApp === 'undefined') {
                console.error('GroceryPOSApp غير معرف!');
                throw new Error('GroceryPOSApp غير معرف');
            }
            
            // تهيئة التطبيق
            const app = new GroceryPOSApp();
            window.app = app;
            await app.init();
            
            console.log('✅ تم تحميل التطبيق بنجاح');
        } catch (error) {
            console.error('❌ فشل تحميل التطبيق:', error);
            
            // عرض رسالة خطأ للمستخدم
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: #f44336;
                color: white;
                padding: 20px;
                border-radius: 10px;
                z-index: 99999;
                text-align: center;
                max-width: 80%;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            errorDiv.innerHTML = `
                <h3 style="margin: 0 0 10px 0;">خطأ في تحميل التطبيق</h3>
                <p style="margin: 0 0 15px 0;">${error.message}</p>
                <button onclick="location.reload()" style="
                    background: white;
                    color: #f44336;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                ">
                    إعادة تحميل الصفحة
                </button>
            `;
            document.body.appendChild(errorDiv);
        }
    }

    // الانتظار حتى تحميل جميع الملفات
    document.addEventListener('DOMContentLoaded', function() {
        console.log('✅ تم تحميل DOM بالكامل');
        
        // الانتظار لتحميل جميع الملفات
        setTimeout(() => {
            initializeApplication();
        }, 100);
    });

    // تسجيل Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(registration => {
                    console.log('✅ تم تسجيل Service Worker:', registration.scope);
                })
                .catch(error => {
                    console.warn('⚠️ فشل تسجيل Service Worker:', error);
                });
        });
    }
</script>
</body>
</html>